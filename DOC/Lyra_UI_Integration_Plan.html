<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDGame - Lyra UI 시스템 적용 계획서</title>
    <style>
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background-color: #f9f9f9;
        }

        h1,
        h2,
        h3 {
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        h1 {
            font-size: 2.2em;
            border-bottom: 3px solid #3498db;
        }

        h2 {
            font-size: 1.8em;
            margin-top: 30px;
        }

        h3 {
            font-size: 1.4em;
            margin-top: 25px;
            color: #34495e;
        }

        ul,
        ol {
            margin-bottom: 20px;
        }

        li {
            margin-bottom: 5px;
        }

        .code-block {
            background-color: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 5px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.9em;
        }

        .note {
            background-color: #e8f4fd;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin: 20px 0;
        }

        .step {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .tag {
            display: inline-block;
            background-color: #e1ecf4;
            color: #39739d;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            margin-right: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: #fff;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <h1>Lyra UI 시스템 적용 계획서 (RDGame)</h1>

    <p>본 문서는 Lyra 프로젝트의 UI 아키텍처 분석을 바탕으로, <strong>RDGame</strong> 프로젝트에 모듈형 UI 시스템(CommonUI 기반)을 도입하기 위한 구체적인 실행 계획을
        기술합니다.</p>

    <div class="note">
        <strong>목표:</strong> 하드 레퍼런스를 제거하고, 확장성(Extensibility)과 정책 기반(Policy-driven)의 UI 관리를 통해 유지보수 효율성을 극대화합니다.
    </div>

    <h2>1. 사전 준비 및 종속성 구성 (Phase 1)</h2>
    <div class="step">
        <h3>1.1 필수 플러그인 활성화</h3>
        <p>Lyra UI의 핵심 기능을 지원하기 위해 다음 플러그인들을 활성화해야 합니다.</p>
        <ul>
            <li><span class="tag">CommonUI</span>: 크로스 플랫폼 입력 및 위젯 관리</li>
            <li><span class="tag">CommonGame</span>: 게임 기능과 UI 연결</li>
            <li><span class="tag">UIExtension</span>: 동적 위젯 주입 시스템</li>
            <li><span class="tag">GameplayTags</span>: UI 레이어 및 식별자 관리</li>
            <li><span class="tag">ModularGameplay</span>: 컴포넌트 기반 아키텍처 지원</li>
            <li><span class="tag">GameFeatures</span>: (선택) 기능 단위 모듈화 시 필요</li>
        </ul>

        <h3>1.2 모듈 종속성 설정 (Build.cs)</h3>
        <p><code>RDGame.Build.cs</code> 파일에 다음 모듈 의존성을 추가합니다:</p>
        <div class="code-block">
            PublicDependencyModuleNames.AddRange(new string[] {
            "CommonUI",
            "CommonInput",
            "CommonGame",
            "UIExtension",
            "GameplayTags",
            "GameFeatures",
            "ModularGameplay"
            });
        </div>
    </div>

    <h2>2. 핵심 클래스 구현 (Phase 2)</h2>
    <div class="step">
        <h3>2.1 기반 위젯 클래스 (URdActivatableWidget)</h3>
        <p>Lyra의 <code>ULyraActivatableWidget</code>을 벤치마킹하여 프로젝트 전용 기반 클래스를 생성합니다.</p>
        <ul>
            <li><strong>InputConfig:</strong> Game/Menu 입력 모드 자동 전환 로직 구현</li>
            <li><strong>GetDesiredInputConfig():</strong> 현재 위젯 상태에 따른 입력 설정 반환</li>
        </ul>

        <h3>2.2 HUD 액터 (ARdHUD)</h3>
        <p>기존 <code>AHUD</code>를 대체하거나 확장하며, UI 시스템의 초기화 앵커 역할을 합니다.</p>
        <ul>
            <li><code>IGameFrameworkInitStateInterface</code> 구현: 초기화 상태 관리</li>
            <li><code>GameFrameworkComponentManager</code>에 리시버 등록</li>
            <li><strong>UI 초기화 이벤트 전송:</strong> <code>BeginPlay</code> 등 적절한 시점에 UI 생성 트리거</li>
        </ul>
    </div>

    <h2>3. UI 매니저 및 정책 구현 (Phase 3)</h2>
    <div class="step">
        <h3>3.1 UI 매니저 서브시스템 (URdUIManagerSubsystem)</h3>
        <p>전역 UI 상태를 관리하고 게임플레이와 UI 간의 동기화를 담당합니다.</p>
        <ul>
            <li><code>UGameUIManagerSubsystem</code> 상속</li>
            <li>HUD 가시성 제어 및 루트 레이아웃 관리</li>
            <li>Tick에서 <code>bShowHUD</code> 상태 모니터링 및 반영</li>
        </ul>

        <h3>3.2 UI 정책 (UI Policy)</h3>
        <p><code>UGameUIPolicy</code>를 상속받아 프로젝트의 UI 생성 규칙을 정의합니다.</p>
        <ul>
            <li><strong>레이어 정의:</strong> Game, GameMenu, Modal, Notification 등 Primary Game Layout의 레이어 구성</li>
        </ul>
    </div>

    <h2>4. HUD 레이아웃 및 확장 시스템 (Phase 4)</h2>
    <div class="step">
        <h3>4.1 메인 HUD 레이아웃 (WBP_RdHUDLayout)</h3>
        <p>화면의 최상위에 배치될 위젯으로, 하위 위젯들을 담을 컨테이너(Stack)들을 포함합니다.</p>
        <ul>
            <li><code>UI.Layer.Game</code>, <code>UI.Layer.Menu</code> 태그를 가진 <code>CommonActivatableWidgetStack</code>
                배치</li>
            <li>입력 장치 변경 감지 및 ESC 메뉴 처리 로직 포함</li>
        </ul>

        <h3>4.2 확장 포인트 (Extension Points)</h3>
        <p>특정 위치(슬롯)에 동적으로 위젯을 주입하기 위한 시스템입니다.</p>
        <ul>
            <li><code>UUIExtensionPointWidget</code>을 HUD 레이아웃의 필요한 곳(예: 미니맵 영역, 스킬 슬롯 등)에 배치</li>
            <li>GameplayTag(예: <code>HUD.Slot.Minimap</code>)를 할당하여 위젯 주입 요청을 수신</li>
        </ul>
    </div>

    <h2>5. 단계별 적용 로드맵</h2>
    <table>
        <tr>
            <th>단계</th>
            <th>작업 내용</th>
            <th>예상 산출물</th>
        </tr>
        <tr>
            <td>1단계</td>
            <td>플러그인 활성화 및 기반 클래스 생성</td>
            <td>RDGame.Build.cs 수정, URdActivatableWidget, ARdHUD</td>
        </tr>
        <tr>
            <td>2단계</td>
            <td>Primary Game Layout 구성</td>
            <td>WBP_PrimaryLayout, UI 정책 설정 (DefaultGame.ini)</td>
        </tr>
        <tr>
            <td>3단계</td>
            <td>기존 UI 이식</td>
            <td>체력바, 스킬창 등을 CommonUI 위젯으로 변환 및 레이어화</td>
        </tr>
        <tr>
            <td>4단계</td>
            <td>확장 시스템 적용 (심화)</td>
            <td>GameFeatures를 통한 UI 요소 동적 로딩 테스트</td>
        </tr>
    </table>

</body>

</html>